worker_processes auto;

events {
  worker_connections 1024;
}

http {
  server {
    listen      80;
    server_name meme.us.kg;
    return      301 https://$host$request_uri;
  }

  server {
    listen                    443 ssl; # 监听 443 端口（HTTPS）
    server_name               meme.us.kg; # 绑定域名
    # 证书路径（替换为实际路径）
    ssl_certificate           /etc/letsencrypt/live/meme.us.kg/fullchain.pem;
    ssl_certificate_key       /etc/letsencrypt/live/meme.us.kg/privkey.pem;
    # 可选：增强安全性的配置（推荐）
    ssl_protocols             TLSv1.2 TLSv1.3; # 仅启用安全的 TLS 协议
    ssl_prefer_server_ciphers on; # 优先使用服务器端加密套件
    ssl_ciphers               ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
    ssl_session_cache         shared:SSL:10m; # 共享会话缓存（10MB）
    ssl_session_timeout       10m; # 会话超时时间
    # 网站根目录和其他配置（根据实际需求修改）
    root                      /var/www/html;
    index                     index.html index.htm;

    location = /nginx {
      return     200
        "Hello there! Your secure connection is up and running! Stay cozy ~ (HTTPS)\n";
      add_header Content-Type text/plain;
      add_header Access-Control-Allow-Origin "*";
      access_log off;
    }

    # 健康检查端点
    location = /ping {
      return     200 "pong from nginx (HTTPS)\n";
      add_header Content-Type text/plain;
      add_header Access-Control-Allow-Origin "*";
      access_log off;
    }

    location / {
      try_files $uri $uri/ =404;
    }
  }
}